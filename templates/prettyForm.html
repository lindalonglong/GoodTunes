{% extends 'base.html' %}
{% block content %}

 <!-- 
  using get method so that the students can see the data being submitted by the form when successful.
  using JS to add novalidate into the form attribute so that we can use HTML5 validation as a fallback if someone is not allowing JS on their page. 
 -->
    
<form action="/login" method="POST" id="sign-up">
  <h1>Sign Up</h1>
  <fieldset>
    <!-- made these fields required -->
    <legend><span class="number">1</span> Your basic info</legend>
    <label for="name">Name:</label>
    <input type="text" id="name" name="name" required placeholder="your name" autofocus>
    <label for="username">Username:</label>
    <input type="text" id="username" name="username" placeholder="Username" required>


    <!-- same for minlength and maxlength: minlength="8" maxlength="20" we're using JS to do this.-->
    <label for="password">Password:</label>
    <input type="password" id="password" name="user_password" placeholder="must be 8-20 characters long" >
    <p class="show">show password</p>

      <div class="error">
          <!-- if the user does not fill out the required elements or has something wrong we can tell the user with this information.-->
      </div>

  </fieldset>

  <fieldset>
    <legend><span class="number">2</span> Your profile</legend>
    <label for="bio">Bio:</label>
    <textarea id="bio" name="user_bio"></textarea>

  </fieldset>

    <button type="submit">Sign Up</button>


</form>

<!-- Note: this javascript checks the user input and makes sure that it's good -->
<script type="text/javascript">
    'use strict'; //ensures we are using the most modern JS interpreter available to the browser. And keeps us on our toes for best practices.

//variables at the top ensure the whole program has access to them.
    const pass = document.querySelector('#password');
    const show = document.querySelector('p.show');
    const form = document.querySelector('#sign-up');
    const errorDiv = document.querySelector('.error');
    const name = document.querySelector('#name');
    const username = document.querySelector('#username');
    form.setAttribute('novalidate', 'novalidate');


/* #1 problem for people is passwords. Sometimes they fatfinger their phone or keyboard and mis-type their password and cannot get into their account. This functionality lets them see what they typed. Passwords are just obsured, not encrypted and not more secure than a regular text box. Good practice is to store them with a hash in a db */
    //event listener for a password viewing toggle.
    show.addEventListener('click', function(){
        //the keyword: this is the item that was clicked. this can be used in other context and can be tricky. Use with care.

        let text = this.textContent; //gets the current text value of the show element
         //compares the value of the text
        if(text === 'show password'){
            this.textContent = 'hide password'; //sets the value of the text
            pass.setAttribute('type', 'text'); //sets the type of input the password input box is.
        }else{
            this.textContent = 'show password';
            pass.setAttribute('type', 'password');
        }

    })

    //form validation: 
    //this event listener is attached to the form and listens for the submit event
    form.addEventListener('submit', function(event){
        //the event parameter/variable works like a local variable to capture the event object, which has lots of information about the event that occured. By having access to the event obect we can access its properties and methods.
            let errors = []; //this is an empty array. it is here to store any error messages we need to output to the page to let the user know he needs to fix.
            let nameVal = name.value.trim();
            let usernameVal = username.value.trim();
            let passVal = password.value.trim(); //trim clears whitespace on both sides of entry. " password " becomes "password"
            //once these have been trimmed reinsert these values into the value attribute:
            name.value = nameVal;
            username.value = usernameVal;
            pass.value = passVal;


            if(nameVal === '' || nameVal == null){
                errors.push('Name is required')
            }

            if(usernameVal === '' || usernameVal == null){
                errors.push('Username is required')
            }


            if(passVal === '' || passVal == null){
                //nothing was entered into the name field.
                errors.push('Password is required. ');
            }else if(passVal.length < 8 || passVal.length > 20){
                errors.push('password must be between 8 and 20 characters long.')
            }


            if(errors.length > 0){
                //this means we have at least one error message. So we need to prevent the form from submitting.
                event.preventDefault(); //this is a method that prevents the event's typical behavior. So in this case we are preventing the page from submitting like it normally would.
                //now we want to let the user know that they need to fill out stuff before they resubmit.
                //populate the errorDiv with the content we want:
                errorDiv.innerHTML = errors.join('<br>');

            }        

    })

/*
    function to check if an item within a set of elements have a checked property
    @parm: set - an array or array like set of elements
    @return - true or false based on if at least one set of elements has the checked property.

*/

    function isChecked(set){
        let check = false;
        for(var i = 0; i < set.length; i++){
            if(set[i].checked === true && check === false){
                check = true;
                break;
            }
        }
        return check;
    }

</script>
{% endblock %}